Kamailio configuration tests
----------------------------

Requeriments:
-------------
 - A working NGCP
 - sip-tester. sipp with ssl enabled ( needed for auth ).
   We provide a version backported to wheezy
 - python-yaml
 - libgraphviz-perl
 - libtemplate-perl
 - libtext-csv-perl
 - ngcp-ossbss-clients-perl
 - parallel
 - tcpdump

Oficial releases:
-----------------

Add sip-tester and kamailio-config-tests repositories (use ngcp3.X):

 #cat > /etc/apt/sources.list.d/kamailio-config-tests.list <<EOF
deb http://jenkins.mgm.sipwise.com/debian sip-tester-wheezy main
deb http://jenkins.mgm.sipwise.com/debian kamailio-config-tests_vseva_ngcp3.0 main
EOF

Force apt to use the backported version of sip-tester from us:

#cat > /etc/apt/preferences.d/kamailio-config-tests << EOF
Package: sip-tester
Pin: origin jenkins.mgm.sipwise.com
Pin-Priority: 991
EOF

 #aptitude update

Debian Deb Installation:
------------------------

# aptitude install kamailio-config-tests

Manual Installation:
-------------
  You can install the scripts in other place but you have
  to modify BASE_DIR environment variable.

  #cd /usr/share/kamailio-config-tests
  #git clone git@git.mgm.sipwise.com:kamailio-config-tests
  #apt-get install python-yaml sip-tester \
                   libgraphviz-perl libtemplate-perl libtext-csv-perl \
                   ngcp-ossbss-clients-perl parallel tcpdump

Usage:
------
  # cd /usr/share/kamailio-config-tests

  If you are using the git version and not in /usr/share/kamailio-config-tests
  you need to set BASE_DIR environment variable accordingly:
  # export BASE_DIR=`pwd`
  This is not needed if you are using the Debian packaged version.

  PROFILE: "CE" the default
           "PRO"
  #bash ./run_tests.sh [-p PROFILE ]

  This will create:
    - $BASE_DIR/log
      with a directory per test with:
      - kamailio.log
      - parsed messages
      - sipp error logs

  #bash ./get_result.sh [-p PROFILE ] [-g]

  This will create:
    - $BASE_DIR/result
      with a directory per test with:
      - a tap file ( test results )
      - a png file ( routes flow ) If you use -g option

 If you want to run test manually just exec this onces:
  #./bin/config_debug.pl on
  #ngcpcfg apply
 and run the check that you want:
  #./bin/check.sh <checkname>
 this will run the test and the result taps
 or run all the tests as many times you want with:
  #./bin/bench.sh $NUM

Development:
------------

Every test has to be located at the scenarios directory. It must include:

 - scenario.yml
 - XXXX_test.yml.tt2
   XXXX indicates the number of kamailio parsed msg XXXX.yml to test
 - sipp_scenarioXX.xml

And can optionally include:
 - sipp_scenario_responderXX.xml
 - prefs.yml
 - callforward.yml
 - speeddial.yml
 - peer.yml
--
Victor Seva <vseva@sipwise.com>
